(function(){var a=function(b,c){var d=a.resolve(b,c||"/"),e=a.modules[d];if(!e)throw Error("Failed to resolve module "+b+", tried "+d);var f=a.cache[d],g=f?f.exports:e();return g};a.paths=[],a.modules={},a.cache={},a.extensions=[".js",".coffee",".json"],a._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},a.resolve=function(){return function(b,c){function h(b){if(b=d.normalize(b),a.modules[b])return b;for(var c=0;a.extensions.length>c;c++){var e=a.extensions[c];if(a.modules[b+e])return b+e}}function i(b){b=b.replace(/\/+$/,"");var c=d.normalize(b+"/package.json");if(a.modules[c]){var e=a.modules[c](),f=e.browserify;if("object"==typeof f&&f.main){var g=h(d.resolve(b,f.main));if(g)return g}else if("string"==typeof f){var g=h(d.resolve(b,f));if(g)return g}else if(e.main){var g=h(d.resolve(b,e.main));if(g)return g}}return h(b+"/index")}function j(a,b){for(var c=k(b),d=0;c.length>d;d++){var e=c[d],f=h(e+"/"+a);if(f)return f;var g=i(e+"/"+a);if(g)return g}var f=h(a);return f?f:void 0}function k(a){var b;b="/"===a?[""]:d.normalize(a).split("/");for(var c=[],e=b.length-1;e>=0;e--)if("node_modules"!==b[e]){var f=b.slice(0,e+1).join("/")+"/node_modules";c.push(f)}return c}if(c||(c="/"),a._core[b])return b;var d=a.modules.path();c=d.resolve("/",c);var e=c||"/";if(b.match(/^(?:\.\.?\/|\/)/)){var f=h(d.resolve(e,b))||i(d.resolve(e,b));if(f)return f}var g=j(b,e);if(g)return g;throw Error("Cannot find module '"+b+"'")}}(),a.alias=function(b,c){var d=a.modules.path(),e=null;try{e=a.resolve(b+"/package.json","/")}catch(f){e=a.resolve(b,"/")}for(var g=d.dirname(e),h=(Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b})(a.modules),i=0;h.length>i;i++){var j=h[i];if(j.slice(0,g.length+1)===g+"/"){var k=j.slice(g.length);a.modules[c+k]=a.modules[g+k]}else j===g&&(a.modules[c]=a.modules[g])}},function(){var b={},c="undefined"!=typeof window?window:{},d=!1;a.define=function(e,f){!d&&a.modules.__browserify_process&&(b=a.modules.__browserify_process(),d=!0);var g=a._core[e]?"":a.modules.path().dirname(e),h=function(b){var c=a(b,g),d=a.cache[a.resolve(b,g)];return d&&null===d.parent&&(d.parent=i),c};h.resolve=function(b){return a.resolve(b,g)},h.modules=a.modules,h.define=a.define,h.cache=a.cache;var i={id:e,filename:e,exports:{},loaded:!1,parent:null};a.modules[e]=function(){return a.cache[e]=i,f.call(i.exports,h,i,i.exports,g,e,b,c),i.loaded=!0,i.exports}}}(),a.define("path",function(a,b,c,d,e,f){function h(a,b){for(var c=[],d=0;a.length>d;d++)b(a[d],d,a)&&c.push(a[d]);return c}function i(a,b){for(var c=0,d=a.length;d>=0;d--){var e=a[d];"."==e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var j=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;c.resolve=function(){for(var a="",b=!1,c=arguments.length;c>=-1&&!b;c--){var d=c>=0?arguments[c]:f.cwd();"string"==typeof d&&d&&(a=d+"/"+a,b="/"===d.charAt(0))}return a=i(h(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b="/"===a.charAt(0),c="/"===a.slice(-1);return a=i(h(a.split("/"),function(a){return!!a}),!b).join("/"),a||b||(a="."),a&&c&&(a+="/"),(b?"/":"")+a},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(h(a,function(a){return a&&"string"==typeof a}).join("/"))},c.dirname=function(a){var b=j.exec(a)[1]||"",c=!1;return b?1===b.length||c&&3>=b.length&&":"===b.charAt(1)?b:b.substring(0,b.length-1):"."},c.basename=function(a,b){var c=j.exec(a)[2]||"";return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return j.exec(a)[3]||""},c.relative=function(a,b){function d(a){for(var b=0;a.length>b&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;e.length>i;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")}}),a.define("__browserify_process",function(a,b,c,d,e,f){var f=b.exports={};f.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){if(a.source===window&&"browserify-tick"===a.data&&(a.stopPropagation(),c.length>0)){var b=c.shift();b()}},!0),function(a){c.push(a),window.postMessage("browserify-tick","*")}}return function(a){setTimeout(a,0)}}(),f.title="browser",f.browser=!0,f.env={},f.argv=[],f.binding=function(b){if("evals"===b)return a("vm");throw Error("No such module. (Possibly not yet loaded)")},function(){var c,b="/";f.cwd=function(){return b},f.chdir=function(d){c||(c=a("path")),b=c.resolve(d,b)}}()}),a.define("/common.js",function(a,b){var h=function(a,b){return a.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a})},i=function(a,b){var c=!1;return $.each(a,function(a,d){return b(d)?(c=d,!1):void 0}),c},j=function(a){a.css("left",$(window).width()/2).css("margin-left",-a.width()/2+"px")},k={supplant:h,detect:i,toCenter:j};b.exports=k}),a.define("/html5-crop.js",function(a,b){var h,i,j,k;h=function(){var c,e,f,g,h,n,b=a("./common.js"),o=function(a,b){var c=this;return c[a]=b,function(b){return c[a]=void 0!==b?b:c[a],c[a]}},p={lt:{x:o("lt_x"),y:o("lt_y")},rt:{x:o("rt_x"),y:o("rt_y")},lb:{x:o("lb_x"),y:o("lb_y")},rb:{x:o("rb_x"),y:o("rb_y")}},q=function(a,d){return b.detect(p,function(b){return Boolean(a>b.x()&&b.x()+c.dot_side>a&&d>b.y()&&b.y()+c.dot_side>d)})},r=function(a,b){return(a>p.lt.x()&&p.rt.x()+c.dot_side>a||a>p.rt.x()&&p.lt.x()+c.dot_side>a)&&(b>p.lt.y()&&p.lb.y()+c.dot_side>b||b>p.lb.y()&&p.lt.y()+c.dot_side>b)},s=function(a){$.each(p,function(b,c){c.active=c==a})},t=function(a,b){return a==p.lt||a==p.lb?p.rt.x()-b:p.lt.x()+b},u=function(a,b){return a==p.lt||a==p.rt?p.lb.y()-b:p.lt.y()+b},v=function(a,b){var c=b,d=p.lt==a||p.lb==a?p.rt.x():p.lt.x();return Math.abs(c-d)},w=function(a,b){var c=b,d=p.lt==a||p.rt==a?p.lb.y():p.lt.y();return Math.abs(c-d)},x=function(){var a=-c.dot_side/2,d=i.width-c.dot_side/2,e=b.detect(p,function(b){return a>=b.x()||b.x()>d});if(!e)return!1;var f=0>=e.x()?"west":"east",g="west"==f?a:d;return{dot:e,compass:f,limit:g}},y=function(){var a=-c.dot_side/2,d=i.height-c.dot_side/2,e=b.detect(p,function(b){return a>=b.y()||b.y()>d});if(!e)return!1;var f=0>=e.y()?"north":"south",g="north"==f?a:d;return{dot:e,compass:f,limit:g}},z=function(a,b,c){var d=b/2-a/2,e=c/2-a/2;p.lt.x(d),p.lt.y(e),p.lb.x(d),p.lb.y(e+a),p.rt.x(d+a),p.rt.y(e),p.rb.x(d+a),p.rb.y(e+a)},A=function(){f.show(),toCenter(e)},B=function(){c.use_native_modal&&(e.append(n),A()),c.onDomCreated(n)};return{init:function(a){c=$.extend({CROP_NAME:"резать",CANCEL:"отмена",MIN_IMG_SIDE_ERROR:"Слишком маленькое изображение по ширине или выстоте",CANVAS_NOT_SUPPORTED:"canvas not supported in this browser",square_mode:!0,max_crop_side:400,min_crop_side:50,max_img_side:600,min_img_side:100,init_crop_side:100,dot_side:10,use_native_modal:!0,use_native_button:!0,onDomCreated:function(){},oncancel:function(){},oncrop:function(){},alertFn:function(a){alert(a)},modal_class:"modal"},a),n=$("<div><div style='position: relative'><canvas></canvas><canvas style='position:absolute; top:0; left:0'></canvas><canvas style='position:absolute; top:0; left:0'></canvas></div></div>"),c.use_native_modal&&(f=$(b.supplant("<div class='darken_bgr' style='display:none'><div class='{modal_class}' style='position:fixed;'></div></div>",{modal_class:c.modal_class})),e=f.find("."+c.modal_class)),c.use_native_button&&(g=$(b.supplant("<input type='button' name='crop' value='{cropname}'/>",{cropname:c.CROP_NAME})),h=$(b.supplant("<input type='button' name='cancel' value='{cancel}'/>",{cancel:c.CANCEL})),n.append(g).append(h));var d=n.find("canvas");return i=d[0],j=d[1],k=d[2],i.getContext?(this.setUrl(c.url),this.setButtonActions(),$("body").append(f),void 0):(c.alertFn(c.CANVAS_NOT_SUPPORTED),!1)},setUrl:function(){var b=this,d=document.createElement("img");$(d).on("load",function(){var a=this.width,d=this.height;return(a>c.max_img_side||d>c.max_img_side)&&(a>d?(this.width=c.max_img_side,this.height=d*this.width/a):(this.height=c.max_img_side,this.width=a*this.height/d),a=this.width,d=this.height),c.min_img_side>a||c.min_img_side>d?(c.alertFn(c.MIN_IMG_SIDE_ERROR),!1):(i.width=a,i.height=d,i.getContext("2d").drawImage(this,0,0,a,d),j.width=a,j.height=d,k.width=a,k.height=d,B(),z(c.init_crop_side,a,d),b.setActionHandlers(k),b.draw(),void 0)}),d.src=c.url},draw:function(){var a=k.getContext("2d");a.clearRect(0,0,k.width,k.height),a.fillStyle="rgba(255, 255, 255, 0.8)",a.strokeStyle="#000",$.each(p,function(b,d){a.fillRect(d.x(),d.y(),c.dot_side,c.dot_side),a.strokeRect(d.x(),d.y(),c.dot_side,c.dot_side)});var b=j.getContext("2d");b.fillStyle="rgba(0, 0, 0, 0.5)",b.clearRect(0,0,k.width,k.height),b.fillRect(0,0,k.width,k.height),b.clearRect(p.lt.x()+c.dot_side/2,p.lt.y()+c.dot_side/2,p.rt.x()-p.lt.x(),p.lb.y()-p.lt.y())},moveArea:function(a,b,c,d){var e=c-a,f=d-b;$.each(p,function(a,b){b.x(b.x()-e),b.y(b.y()-f)});var g=x();if(g){var h=v(g.dot,g.dot.x());"west"==g.compass?(p.lt.x(g.limit),p.lb.x(g.limit),p.rt.x(g.limit+h),p.rb.x(g.limit+h)):(p.rt.x(g.limit),p.rb.x(g.limit),p.lt.x(g.limit-h),p.lb.x(g.limit-h))}var i=y();if(i){var j=w(i.dot,i.dot.y());"north"==i.compass?(p.lt.y(i.limit),p.rt.y(i.limit),p.lb.y(i.limit+j),p.rb.y(i.limit+j)):(p.lb.y(i.limit),p.rb.y(i.limit),p.lt.y(i.limit-j),p.rt.y(i.limit-j))}this.draw()},moveDot:function(a,d){a-=c.dot_side/2,d-=c.dot_side/2;var g=b.detect(p,function(a){return a.active}),h=v(g,a),i=w(g,d);g.x(a),g.y(d);var j=x();if(j){var k=v(j.dot,j.dot.x());"west"==j.compass?(p.lt.x(j.limit),p.lb.x(j.limit),p.rt.x(j.limit+k),p.rb.x(j.limit+k)):(p.rt.x(j.limit),p.rb.x(j.limit),p.lt.x(j.limit-k),p.lb.x(j.limit-k))}var l=y();if(l){var m=w(l.dot,l.dot.y());"north"==l.compass?(p.lt.y(l.limit),p.rt.y(l.limit),p.lb.y(l.limit+m),p.rb.y(l.limit+m)):(p.lb.y(l.limit),p.rb.y(l.limit),p.lt.y(l.limit-m),p.rt.y(l.limit-m))}c.max_crop_side&&(h>=c.max_crop_side&&g.x(t(g,c.max_crop_side)),i>=c.max_crop_side&&g.y(u(g,c.max_crop_side))),c.min_crop_side&&(c.min_crop_side>=h&&g.x(t(g,c.min_crop_side)),c.min_crop_side>=i&&g.y(u(g,c.min_crop_side))),c.square_mode&&(h=v(g,g.x()),i=w(g,g.y()),h!==i&&(i>h?g.x(t(g,i)):g.y(u(g,h)))),g==p.lt&&(p.rt.y(g.y()),p.lb.x(g.x())),g==p.rb&&(p.rt.x(g.x()),p.lb.y(g.y())),g==p.rt&&(p.lt.y(g.y()),p.rb.x(g.x())),g==p.lb&&(p.lt.x(g.x()),p.rb.y(g.y())),this.draw()},setActionHandlers:function(a){var c,d,b=this,e=!1;$(a).on("mousedown",function(a){c=b.getTarget(a.offsetX||a.originalEvent.layerX,a.offsetY||a.originalEvent.layerY),"dot"==c&&s(q(a.offsetX||a.originalEvent.layerX,a.offsetY||a.originalEvent.layerY)),d={x:a.offsetX||a.originalEvent.layerX,y:a.offsetY||a.originalEvent.layerY},e=!0}),$(a).on("mousemove",function(f){e?"dot"==c?b.moveDot(f.offsetX||f.originalEvent.layerX,f.offsetY||f.originalEvent.layerY,d.x,d.y):"area"==c&&(b.moveArea(f.offsetX||f.originalEvent.layerX,f.offsetY||f.originalEvent.layerY,d.x,d.y),d={x:f.offsetX||f.originalEvent.layerX,y:f.offsetY||f.originalEvent.layerY}):b.setCursor(a,b.getTarget(f.offsetX||f.originalEvent.layerX,f.offsetY||f.originalEvent.layerY),q(f.offsetX||f.originalEvent.layerX,f.offsetY||f.originalEvent.layerY))}),$(a).on("mouseup",function(){c=!1,e=!1})},getTarget:function(a,b){return q(a,b)?"dot":r(a,b)?"area":!1},setCursor:function(a,b,c){"dot"==b?(c==p.lt&&$(a).css("cursor","nw-resize"),c==p.rt&&$(a).css("cursor","ne-resize"),c==p.rb&&$(a).css("cursor","se-resize"),c==p.lb&&$(a).css("cursor","sw-resize")):"area"==b?$(a).css("cursor","pointer"):$(a).css("cursor","default")},setButtonActions:function(){var a=this;c.use_native_button&&(g.on("click",function(){a.crop()}),h.on("click",function(){a.cancel()}))},crop:function(){var a=i.getContext("2d").getImageData(p.lt.x()+c.dot_side/2,p.lt.y()+c.dot_side/2,p.rt.x()-p.lt.x(),p.lb.y()-p.lt.y()),b=document.createElement("canvas");b.width=Math.abs(p.rt.x()-p.lt.x()),b.height=Math.abs(p.lb.y()-p.lt.y()),b.getContext("2d").putImageData(a,0,0);var d=b.toDataURL();c.oncrop&&c.oncrop(d),c.use_native_modal&&f.hide()},cancel:function(){c.use_native_modal&&f.hide(),c.oncancel()}}}(),b.exports={html5Crop:h}}),a.define("/html5-webcam.js",function(a){window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,function(b){var c=a("./common.js"),d=a("./html5-crop.js").html5Crop;window.html5Crop=d,b.fn.html5WebCam=function(a){return b(this).each(function(){var e=b(this),f=this;if(e.data("html5WebCam"))return"string"!=typeof a?!1:e.data(a)?e.data(a)():d.crop();e.data("html5WebCam",!0);var g,h,i,j,k,l=b.extend({NOT_SUPPORT_FEATURE:"Этот браузер не поддерживает захват с камеры",CAMERA_NOT_FOUND:"Камера не найдена на этом устройстве",CLICK_TO_PAUSE:"Нажмите для воспроизведения/остановки",TAKE_SNAPSHOT:"Сделать снимок",CANCEL:"Отмена",max_video_size:600,modal_class:"modal",use_native_modal:!0,use_native_button:!0,onDomCreated:function(){},onsnapshot:function(){},use_crop:!0,oncrop:function(){},oncancel:function(){},alertFn:function(a){alert(a)}},a),m=c.supplant("<div><div><video autoplay title='{pause}'></div></div>",{pause:l.CLICK_TO_PAUSE}),n=b(m);e.data("snapshot",function(){var a=p.paused?o.data("data-url"):s();p.pause();try{g.stop()}catch(c){}if(l.use_native_modal&&h.hide(),l.onsnapshot(a),l.use_crop){var j=b.extend({},l);d.init(b.extend(j,{url:a,oncrop:function(a){l.oncrop.apply(f,[a]),h.hide()},onDomCreated:function(a){l.use_native_modal&&(i.children().detach(),i.append(a),q()),l.onDomCreated.apply(f,[a])},use_native_modal:!1,oncancel:function(){e.data("cancel")()}}))}}),e.data("cancel",function(){p.pause();try{g.stop()}catch(a){}l.use_native_modal&&h.hide(),l.oncancel()}),l.use_native_button&&(j=b(c.supplant("<input type='button' name='snapshot' value='{snapshot}'/>",{snapshot:l.TAKE_SNAPSHOT})),k=b(c.supplant("<input type='button' name='cancel' value='{cancel}'/>",{cancel:l.CANCEL})),n.append(j).append(k),j.on("click",function(){e.data("snapshot")()}),k.on("click",function(){e.data("cancel")()})),l.use_native_modal&&(h=b(c.supplant("<div class='darken_bgr' style='display:none'><div class='{modal_class}' style='position:fixed;'></div></div>",{modal_class:l.modal_class})),i=h.find("."+l.modal_class),b("body").append(h));var o=n.find("video"),p=o[0],q=function(){h.show(),c.toCenter(i)},r=function(){l.use_native_modal&&(i.children().detach(),i.append(n),q()),l.onDomCreated(n)},s=function(){var a=document.createElement("canvas"),b=o.width(),c=o.height();return a.width=b,a.height=c,a.getContext("2d").drawImage(p,0,0,b,c),a.toDataURL()};p.addEventListener("click",function(){p.paused?p.play():(o.data("data-url",s()),p.pause())}),p.addEventListener("loadedmetadata",function(){l.max_video_size&&(p.videoWidth>l.max_video_size||p.videoHeight>l.max_video_size)&&(p.videoWidth>p.videoHeight?o.width(l.max_video_size):o.height(l.max_video_size)),r(),p.play()}),e.on("click",function(){return navigator.getUserMedia?(navigator.getUserMedia&&navigator.getUserMedia({video:!0},function(a){g=a;try{p.src=window.URL.createObjectURL(g)}catch(b){p.src=g}},function(){l.alertFn(l.CAMERA_NOT_FOUND)}),void 0):(l.alertFn(l.NOT_SUPPORT_FEATURE),!1)})}),this}}(jQuery)}),a("/html5-webcam.js")})();
